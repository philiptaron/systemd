<aside class="sidebar">
    <nav class="site-nav">
        <h2><a href="{{ site.baseurl }}/">{{ site.title }}</a></h2>

        {% assign is_index = false %}
        {% assign is_release = false %}
        {% if page.url == "/" %}{% assign is_index = true %}{% endif %}
        {% if page.url == "/index.html" %}{% assign is_index = true %}{% endif %}
        {% if page.url contains "systemd-" %}{% assign is_release = true %}{% endif %}

        {% if is_index %}
        <!-- Index page: show releases with section sublists -->
        {% for release_entry in site.data.releases %}
        {% assign release = release_entry[1] %}
        <h3><a href="{{ site.baseurl }}{{ release.path }}">{{ release.title }}</a></h3>
        <ol class="toc-list">
            {% for section in release.sections %}
            <li><a href="{{ site.baseurl }}{{ release.release_notes }}#{{ section.anchor }}">{{ section.title }}</a></li>
            {% endfor %}
        </ol>
        {% endfor %}

        {% elsif is_release %}
        <!-- Release page: show commentary + sections -->
        {% assign release = site.data.releases.v259 %}

        <h3>Commentary</h3>
        <ul class="toc-list">
            {% for post in release.commentary %}
            <li><a href="{{ site.baseurl }}{{ post.path }}">{{ post.num }}. {{ post.title }}</a></li>
            {% endfor %}
        </ul>

        <h3>Sections</h3>
        <ul class="toc-list">
            {% for section in release.sections %}
            <li><a href="{{ site.baseurl }}{{ release.release_notes }}#{{ section.anchor }}">{{ section.title }}</a></li>
            {% endfor %}
        </ul>

        {% else %}
        <!-- Fallback: simple navigation -->
        {% include navigation.html %}
        {% endif %}
    </nav>
</aside>
